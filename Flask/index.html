<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Flask - CEU matters</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <link href="../stylesheets/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/Bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/HTML.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/Java.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/JavaScript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/Perl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/Python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/R.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="..">CEU matters</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">   </a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Chronicle <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2025/" class="dropdown-item">2025</a>
</li>
                                    
<li>
    <a href="../2024/" class="dropdown-item">2024</a>
</li>
                                    
<li>
    <a href="../2023/" class="dropdown-item">2023</a>
</li>
                                    
<li>
    <a href="../2022/" class="dropdown-item">2022</a>
</li>
                                    
<li>
    <a href="../2021/" class="dropdown-item">2021</a>
</li>
                                    
<li>
    <a href="../2020/" class="dropdown-item">2020</a>
</li>
                                    
<li>
    <a href="../Cambridge-Baker-Joint-Symposium/" class="dropdown-item">The Cambridge/Baker Joint Symposium</a>
</li>
                                    
<li>
    <a href="../COVID-19/" class="dropdown-item">COVID-19</a>
</li>
                                    
<li>
    <a href="../dpp/" class="dropdown-item">Data Protection Policy</a>
</li>
                                    
<li>
    <a href="../mhs/" class="dropdown-item">Mental health support</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../HDR-UK/" class="nav-link">HDR(UK)</a>
                            </li>
                            <li class="navitem">
                                <a href="../schedules/" class="nav-link">Schedules</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../CEU/" class="dropdown-item">Cardiovascular Epidemiology Unit</a>
</li>
                                    
<li>
    <a href="../DPHPC/" class="dropdown-item">Department of Public Health and Primary Care</a>
</li>
                                    
<li>
    <a href="../VPD-HLRI/" class="dropdown-item">Victor Phillip Dahdaleh Heart and Lung Research Institute</a>
</li>
                                    
<li>
    <a href="../ClinicalSchool/" class="dropdown-item">Clinical School</a>
</li>
                                    
<li>
    <a href="../UniversityofCambridge/" class="dropdown-item">University of Cambridge</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Student-Run Computing Facility</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="https://www.srcf.net/terminal/" class="dropdown-item">Terminal</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Flask</a>
</li>
            
<li>
    <a href="../c6/" class="dropdown-item">c6</a>
</li>
            
<li>
    <a href="../Node/" class="dropdown-item">Node.js</a>
</li>
            
<li>
    <a href="../webserver/" class="dropdown-item">WebServer</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../channels/" class="nav-link">Channels</a>
                            </li>
                            <li class="navitem">
                                <a href="../talks/" class="nav-link">Talks</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../UniversityofCambridge/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../c6/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/cambridge-ceu/CEU-matters/" class="nav-link"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#flask" class="nav-link">Flask</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#structure" class="nav-link">Structure</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#apppy" class="nav-link">app.py</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#indexhtml" class="nav-link">index.html</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#running" class="nav-link">Running</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#references" class="nav-link">References</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="flask">Flask</h1>
<p>Web: <a href="https://flask.palletsprojects.com/">https://flask.palletsprojects.com/</a></p>
<h2 id="structure">Structure</h2>
<p>A particular directory called <code>templates</code> is created as follows.</p>
<pre><code class="language-bash">if [ ! -d templates ]; then mkdir templates; fi
</code></pre>
<p>The organisation is apparent with <code>tree</code>,</p>
<pre><code>├── app.py
├── templates
│   └── index.html
└── uwsgi.ini
</code></pre>
<h2 id="apppy">app.py</h2>
<pre><code class="language-python">from flask import Flask, render_template
from datetime import datetime

app = Flask(__name__)

@app.route(&quot;/&quot;)
def home():
  return render_template(&quot;index.html&quot;, now=datetime.now())
</code></pre>
<h2 id="indexhtml">index.html</h2>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;!-- Required meta tags --&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt;
&lt;title&gt;Your First Web Server&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Current time: {{now}}&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>which includes <code>{{now}}</code> in <code>Jinja2</code> template syntax.</p>
<h2 id="running">Running</h2>
<pre><code class="language-bash">export FLASK_ENV=development
export FLASK_APP=app.py
flask run
</code></pre>
<p>In addition, <code>flask routes</code> gives the following information</p>
<pre><code>Endpoint  Methods  Rule
--------  -------  -----------------------
home      GET      /
static    GET      /static/&lt;path:filename&gt;
</code></pre>
<p>Upon running Flask using the default port 5000, it can be acessed via</p>
<pre><code class="language-bash">firefox http://127.0.0.1:5000
</code></pre>
<p>It then produces the following output,</p>
<pre><code>Current time: 2023-11-18 16:29:33.365224
</code></pre>
<h3 id="gunicorn">gunicorn</h3>
<p>Web: <a href="https://docs.gunicorn.org/en/stable/">https://docs.gunicorn.org/en/stable/</a></p>
<p>The syntax is as follows,</p>
<pre><code class="language-bash">gunicorn -w 2 app:app
</code></pre>
<p>Note that it is <code>Listening at: http://127.0.0.1:8000</code>, and it is easily changed via the <code>--bind/-b option</code>.</p>
<blockquote>
<p>According to the Gunicorn documentation, the recommended number of workers (-w #) for an application running on a single production server is (2 × number_of_CPU cores) + 1. The formula is loosely based on the idea that for any given CPU core, one worker will be performing IO (input/output) operations, and the other worker will be performing CPU operations.</p>
</blockquote>
<h3 id="uwsgi">uWSGI</h3>
<p>Web: <a href="https://uwsgi-docs.readthedocs.io/en/latest/">https://uwsgi-docs.readthedocs.io/en/latest/</a></p>
<p>The configuration file is named <code>uwsgi.ini</code>, </p>
<pre><code>[uwsgi]

master = true
module = app:app
http-socket = :9090
http-timeout = 86400
http-timeout-asynchronous = true
logto = uwsgi.log

plugin = python3
processes = 4
threads = 1
</code></pre>
<p>then start with</p>
<pre><code class="language-bash">uwsgi --ini uwsgi.ini
</code></pre>
<p>Now http://127.0.0.1:9090 is accessible and <code>wsgi.log</code> has</p>
<pre><code>*** Starting uWSGI 2.0.18-debian (64bit) on [Tue Nov 21 11:51:35 2023] ***
compiled with version: 10.0.1 20200405 (experimental) [master revision 0be9efad938:fcb98e4978a:705510a708d3642c9c962beb663c476167e4e8a4] on 11 April 2020 11:15:55
os: Linux-5.4.0-164-generic #181-Ubuntu SMP Fri Sep 1 13:41:22 UTC 2023
nodename: pip
machine: x86_64
clock source: unix
pcre jit disabled
detected number of CPU cores: 4
current working directory: /public/home/jhz22
detected binary path: /usr/bin/uwsgi-core
your processes number limit is 95938
your process address space limit is 53687091200 bytes (51200 MB)
your memory page size is 4096 bytes
detected max file descriptor number: 1024
lock engine: pthread robust mutexes
thunder lock: disabled (you can enable it with --thunder-lock)
uwsgi socket 0 bound to TCP address :9090 fd 3
Python version: 3.8.10 (default, May 26 2023, 14:05:08)  [GCC 9.4.0]
Python main interpreter initialized at 0x55c45936bbc0
python threads support enabled
your server socket listen backlog is limited to 100 connections
your mercy for graceful operations on workers is 60 seconds
mapped 364600 bytes (356 KB) for 4 cores
*** Operational MODE: preforking ***
WSGI app 0 (mountpoint='') ready in 0 seconds on interpreter 0x55c45936bbc0 pid: 1802332 (default app)
*** uWSGI is running in multiple interpreter mode ***
spawned uWSGI master process (pid: 1802332)
spawned uWSGI worker 1 (pid: 1802384, cores: 1)
spawned uWSGI worker 2 (pid: 1802385, cores: 1)
spawned uWSGI worker 3 (pid: 1802386, cores: 1)
spawned uWSGI worker 4 (pid: 1802387, cores: 1)
</code></pre>
<h2 id="references">References</h2>
<ol>
<li>Farrell D. (2023) The Well-Grounded Python Developer. Manning Publications Co., <a href="https://github.com/writeson">GitHub</a> <a href="https://github.com/writeson/the-well-grounded-python-developer">code</a>, <a href="https://livebook.manning.com/book/the-well-grounded-python-developer/">Live book</a>, Highlight: <a href="../c6">Chapter 6</a>.</li>
<li>Adedeji O. (2023) Full-Stack Flask and React. Packt Publishing, <a href="https://github.com/PacktPublishing/Full-Stack-Flask-and-React">GitHub</a>.</li>
<li>Anni P. (2024) A ythonic Adventure - From Python basics to a working web app. Manning, <a href="https://github.com/pavelanni/pythonicadventure-code">Github</a> &amp; <a href="https://livebook.manning.com/book/a-pythonic-adventure/">Livebook</a>.</li>
</ol></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../javascripts/config.js"></script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
